{% extends 'base.html.twig' %}

{% block title %}{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <style>
        .info-card{
            max-width: 760px;
            margin: 24px auto 0;
            padding: 22px;
            border-radius: 16px;
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.12);
        }

        .info-card h1{
            margin: 0 0 8px;
            font-size: clamp(1.6rem, 2.5vw, 2.2rem);
        }

        .info-card p{
            margin: 0 0 16px;
            color: rgba(255,255,255,.66);
        }

        .info-card .meta{
            font-size: .95rem;
            color: rgba(255,255,255,.66);
        }
        .LogOutBtn{

        }
    </style>
{% endblock %}
{% block body %}

    <header class="topbar">
        <button type="button" onclick="window.location.href='{{ path('app_logout') }}'">
            Logout
        </button>
    </header>



    <section class="info-card">
        <h1>Hello {{ Username }}! </h1>
        <p>{% for Role in Roles %}{{ Role }}{% endfor %}</p>

        <div id="emailDisplay">
            {% if hasEmail %}
                <p>Your email is: {{ email }}</p>
            {% else %}
                <form id="emailForm" method="post" >
                    <input id="emailInput" type="email" name="email" required>
                    <button type="submit">Add</button>
                </form>
            {% endif %}
            <span id="emailTaken" style="display: none">Email is taken</span>
        </div>

    </section>


    <script>
        const form = document.getElementById('emailForm');

        if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const input = document.getElementById('emailInput');
            const email = input.value;

            const res = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'X-Requested-With': 'XMLHttpRequest' },
                credentials: 'include'
            });

            const data = await res.json();

            if (data.emailAdded) {
                document.getElementById('emailDisplay').innerHTML =
                    `<p>Your email is: ${email}</p>`;
            } else if(data.emailExists)
            {
                document.getElementById('emailTaken').style.display = 'inline';

            }
        });}
    </script>
{% endblock %}
